<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>RO Sales App</title>

    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: radial-gradient(circle at top, #eef2ff, #e0e7ff);
            min-height: 100vh;
        }

        .card {
            background: white;
            width: 500px;
            margin: 60px auto;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.12);
            text-align: center;
        }

        select, input {
            width: 100%;
            padding: 14px;
            margin: 10px 0;
            border-radius: 10px;
            border: 1px solid #ccc;
        }

        button {
            width: 100%;
            padding: 14px;
            background: #0071e3;
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 15px;
        }

        .secondary {
            background: #34c759;
            margin-top: 10px;
        }

        table {
            width: 100%;
            margin-top: 20px;
            border-collapse: collapse;
        }

        th, td {
            padding: 10px;
            border-bottom: 1px solid #eee;
        }

        .total {
            font-size: 20px;
            color: green;
            margin-top: 15px;
        }

        /* Modal popup */
        .modal {
            display: none;
            position: fixed;
            z-index: 999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.45);
        }

        .modal-content {
            background: white;
            width: 380px;
            margin: 15% auto;
            padding: 30px;
            border-radius: 16px;
            text-align: center;
            box-shadow: 0 30px 60px rgba(0,0,0,0.25);
        }

        .modal-content h2 {
            color: #2e7d32;
        }

        .modal-content button {
            background: #0071e3;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            cursor: pointer;
        }

        .nav-links {
            margin: 15px 0;
        }
    </style>
</head>

<body>

<div class="card">
    <h2>RO Sales Entry</h2>

    <select id="product">
        <option value="">Select Product</option>
        <option value="MacBook Pro|200000">MacBook Pro</option>
        <option value="iPhone 15 Pro|150000">iPhone 15 Pro</option>
        <option value="iPad Air|80000">iPad Air</option>
        <option value="Apple Watch|50000">Apple Watch</option>
        <option value="AirPods|10000">AirPods</option>
    </select>

    <input type="number" id="qty" min="1" placeholder="Enter Quantity">

    <button id="addBtn">Add to cart</button>

    <div class="nav-links">
        <a href="/dashboard">ðŸ“Š View Dashboard</a>
    </div>

    <!-- ðŸ” Secure Logout -->
    <form method="POST" action="{{ url_for('logout') }}">
        {{ csrf_token() }}
        <button type="submit" class="secondary">Logout</button>
    </form>

    <table>
        <thead>
            <tr>
                <th>Product</th>
                <th>Qty</th>
                <th>Price</th>
                <th>Total</th>
            </tr>
        </thead>
        <tbody id="cart"></tbody>
    </table>

    <div class="total" id="total">Total: â‚¹ 0</div>

    <button class="secondary" id="purchaseBtn">Purchase</button>
</div>

<!-- Success Modal -->
<div id="successModal" class="modal">
    <div class="modal-content">
        <h2>âœ… Purchase Successful</h2>
        <p id="successMsg"></p>
        <button onclick="closeModal()">OK</button>
    </div>
</div>

<script>
let totalAmount = 0;

function formatINR(num) {
    return num.toLocaleString("en-IN");
}

document.getElementById("addBtn").onclick = function () {
    const productValue = document.getElementById("product").value;
    const qty = parseInt(document.getElementById("qty").value);

    if (!productValue) {
        alert("Please select a product");
        return;
    }

    if (!qty || qty <= 0) {
        alert("Please enter valid quantity");
        return;
    }

    const [name, priceStr] = productValue.split("|");
    const price = parseInt(priceStr);

    const lineTotal = qty * price;
    totalAmount += lineTotal;

    document.getElementById("cart").innerHTML += `
        <tr>
            <td>${name}</td>
            <td>${qty}</td>
            <td>â‚¹ ${formatINR(price)}</td>
            <td>â‚¹ ${formatINR(lineTotal)}</td>
        </tr>
    `;

    document.getElementById("total").innerText =
        "Total: â‚¹ " + formatINR(totalAmount);

    document.getElementById("qty").value = "";
};

document.getElementById("purchaseBtn").onclick = function () {
    if (totalAmount === 0) {
        alert("Cart is empty");
        return;
    }

    document.getElementById("successMsg").innerText =
        "Amount Paid: â‚¹ " + formatINR(totalAmount);

    document.getElementById("successModal").style.display = "block";

    document.getElementById("cart").innerHTML = "";
    document.getElementById("total").innerText = "Total: â‚¹ 0";
    totalAmount = 0;
};

function closeModal() {
    document.getElementById("successModal").style.display = "none";
}
</script>

</body>
</html>
